#!/bin/bash

# ì„œë²„ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
# ì‚¬ìš©ë²•: ./deploy.sh

set -e

echo "ğŸš€ ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."

# 1. í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
echo "ğŸ“¦ í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì¤‘..."
cd frontend-user
if [ ! -d "node_modules" ]; then
  echo "npm íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
  npm install
fi
npm run build
cd ..

# 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ
echo "ğŸ³ Docker ì´ë¯¸ì§€ ë¹Œë“œ ì¤‘..."
docker compose -f docker-compose.yml build

# 3. ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì œê±°
echo "ğŸ›‘ ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì¤‘..."
docker compose -f docker-compose.yml down

# 4. ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘
echo "â–¶ï¸  ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘ ì¤‘..."
docker compose -f docker-compose.yml up -d

# 5. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
echo "ğŸ“Š ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸ ì¤‘..."
sleep 5
docker compose -f docker-compose.yml ps

echo "âœ… ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
echo ""
echo "ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:"
echo "  docker compose -f docker-compose.yml logs -f"
echo ""
echo "ì´ˆê¸° ë°ì´í„°ë¥¼ ì„¤ì •í•˜ë ¤ë©´:"
echo "  docker compose -f docker-compose.yml exec backend npm run seed"

